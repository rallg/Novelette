%%
%% This is file Novelette-Settings.sty,
%% part of Novelette document class.
%% Copyright 2022 Robert Allgeyer.
%%
%% It may be used, distributed, and/or modified under the
%% conditions of the MIT License. See:
%% https://opensource.org/licenses/MIT
%%
%%
\ProvidesFile{Novelette-Settings.sty}%
[2022/06/22 v0.0.1 LuaLaTeX file (layout settings)]
%%


%% Define \purpose{book,markup,cover}:
\newif \if@book
\newif \if@coverart
\newif \if@markupcopy
\newcommand\purpose[1]{
  \@tempTFfalse
  \ifthenelse{\equal{#1}{book}}{\@booktrue \@tempTFtrue}{}
  \ifthenelse{\equal{#1}{cover}}{\@coverarttrue \@tempTFtrue}{}
  \ifthenelse{\equal{#1}{markup}}{\@markupcopytrue \@tempTFtrue}{}
  \if@tempTF\else
    \ClassError{Novelette}{Bad choice in \string\purpose{choice}}%
    {Available choices:  book  markup  cover }
  \fi
}
\purpose{book} % Default.

%% Define \template{number}{name}:
\newif \if@templateset
\newcommand\template[2]{%
  \gdef\my@template{#1}
  \gdef\my@trimname{#2}
  \IfSubStr{1 2 3}{\my@template}{}{%
    \ClassError{Novelette}{Incorrect choice of template number}%
    {In \string\template{number}{name} number must be 1, 2, or 3.}%
  }
  \IfSubStr{Novella B Memoir Demy Digest Trade Royal}{\my@trimname}{}{%
    \ClassError{Novelette}{Incorrect choice of size name}%
    {In \string\template{number}{name} name must be one of: ^^J%
     Novella B Memoir Demy Digest Trade Royal ^^J%
     The name is case-sensitive.}%
  }
  \@templatesettrue
}
%%

%% Define \upshift{number} Tweak: Moves bottom of text up 0 to 2 lines.
\newcommand\upshift[1]{ %  Number 0-2. May be decimal.
  \@tempTFtrue
  \FPiflt{#1}{0}\@tempTFfalse\fi
  \FPifgt{#1}{2}\@tempTFfalse\fi
  \if@tempTF
    \gdef\my@upshift{#1}
  \else
    \ClassError{Novelette}{Bad value in \string\upshift{}}*
    {Value 0 - 2. May be decimal.}%
  \fi
}
\upshift{0} % Default.
%%

%% Define \media{book,markup}{width}{height} :
\newif \if@MediaSize % When trim size is floated in larger PDF page size.
\DeclareDocumentCommand\media { m m m } {
  \@tempTFfalse
  \ifthenelse{\equal{#1}{book}}{\@tempTFtrue}{}
  \ifthenelse{\equal{#1}{markup}}{\@tempTFtrue}{}
  \if@tempTF\else
    \ClassError{Novelette}{Bad first argument for \string\media}
    {First argument must be one of:  book  markup}
  \fi
  \ifthenelse{\equal{#2}{} \AND \equal{#3}{}}{}{ % Do nothing. Else:
    \@tempTFfalse
    \IfEndWith{#1}{in}{\@tempTFtrue}{}
    \IfEndWith{#1}{mm}{\@tempTFtrue}{}
    \IfEndWith{#1}{cm}{\@tempTFtrue}{}
    \if@tempTF\else
      \ClassError{Novelette}{Bad second argument for \string\media}%
      {Second argument must be width. Units: mm cm in ^^J
       Or. second and third arguments both empty}%
    \fi
    \@tempTFfalse
    \IfEndWith{#2}{in}{\@tempTFtrue}{}
    \IfEndWith{#2}{mm}{\@tempTFtrue}{}
    \IfEndWith{#2}{cm}{\@tempTFtrue}{}
    \if@tempTF\else
      \ClassError{Novelette}{Bad third argument for \string\media{}}%
      {Third argument must be height. Units: mm cm in
       Or, second and third arguments both empty.}%
    \fi
    \ifthenelse{\dimtest{#2}{<}{#3}}{
      \@MediaSizetrue
      \gsetlength\paperwidth{#2}
      \gsetlength\paperheight{#3}
    }{
      \ClassError{Novelette}{Bad second or third choice for \string\media}%
      {Second argument is width. Third argument is height. ^^J%
       Height must be greater than width.}
    }
  }
}
%%

%% \header{verso or recto}{header text}
%% Except on certain pages (such as section starts),
%% all pages of running text have a visible header. This defines its text.
%% Header text is at Scale=0.88 and loose tracking, relative to main body text.
%% Page number and emblem are added automatically.
%% You may change header text as the book proceeds.
\newcommand\header[2]{
  \@tempTFfalse
  \ifthenelse{\equal{#1}{verso}}{
    \@tempTFtrue
    \gdef\my@versoheader{#2}
  }{}
  \ifthenelse{\equal{#1}{recto}}{
    \@tempTFtrue
    \gdef\my@rectoheader{#2}
  }{}
  \if@tempTF\else
    \ClassError{Novelette}{Bad first argument for \string\header}%
    {For first argument, choose:  verso recto}
  \fi
}
\header{verso}{placeholder} % Changed later.
\header{recto}{placeholder} % Changed later.
%%

%% Emblem is placed next to page number. Choices: none slash bar curve
%%   none, or empty \emblem{} : no emblem.
%%   slash : symmetrical slash (verso) and backslash (recto). Default.
%%   bar : vertical bar
%%   curve : like parentheses, symmetrical verso-recto.
%% These names refer to special characters in Swainson. No other choices.
\newcommand\emblem[1]{ % First argument, verso recto. Second argument, content.
  \@tempTFfalse
  \ifthenelse{\equal{#1}{none} \OR \equal{#1}{}}{
    \@tempTFtrue
    \gdef\my@versoemblem{~}
    \gdef\my@rectoemblem{~}
  }{}
  \ifthenelse{\equal{#1}{slash}}{
    \@tempTFtrue
    \gdef\my@versoemblem{\addfontfeature{StylisticSet=18}/}
    \gdef\my@rectoemblem{\addfontfeature{StylisticSet=18}\textbackslash}
  }{}
  \ifthenelse{\equal{#1}{bar}}{
    \@tempTFtrue
    \gdef\my@versoemblem{\addfontfeature{StylisticSet=18}|}
    \gdef\my@rectoemblem{\addfontfeature{StylisticSet=18}|}
  }{}
  \ifthenelse{\equal{#1}{curve}}{
    \@tempTFtrue
    \gdef\my@versoemblem{\addfontfeature{StylisticSet=18})}
    \gdef\my@rectoemblem{\addfontfeature{StylisticSet=18}(}
  }{}
  \if@tempTF\else
    \ClassError{Novelette}{Bad choice for \string\emblem}%
     {Choices:  none  slash  bar  curve}
  \fi
}
\emblem{slash} % Default.
%%

\DeclareDocumentCommand\PDF { m m } { % Conformance, output intent.
  \StrDel{#1}{/}[\my@pdfc] % Slash is not needed here.
  \@tempTFfalse
  \ifthenelse{\equal{\my@pdfc}{X-1a:2001}}{\@tempTFtrue}{}
  \ifthenelse{\equal{\my@pdfc}{X-3:2002}}{\@tempTFtrue}{}
  \if@tempTF\else
    \ClassError{Novelette}{Bad first argument for \string\PDF}%
      {Case-sensitive choices:  X-1a:2001  X-3:2002}
  \fi
  \ifthenelse{\equal{\my@pdfc}{X-1a:2001} \OR \equal{#1}{X-3:2002}}{
    \gdef\my@conformance{\my@pdfc}
    \@tempTFfalse
    \ifthenelse{\equal{#2}{SWOP}}{\@tempTFtrue}{}
    \ifthenelse{\equal{#2}{FOGRA39}}{\@tempTFtrue}{}
    \ifthenelse{\equal{#2}{JC200103}}{\@tempTFtrue}{}
    \ifthenelse{\equal{#2}{CUSTOM}}{\@tempTFtrue}{}
    \if@tempTF
      \gdef\my@intent{#2}
    \else
      \ClassError{Novelette}{Bad second argument for \string\PDF}%
      {Must be one of:  SWOP  FOGRA39  JC200103  CUSTOM ^^J%
       Caution: See docs before using CUSTOM. Requires expertise.}
    \fi
  }{}
}
\PDF{X-1a:2001}{SWOP} % Default.
\let\pdf\PDF\relax % Make it case-insensitive.




%% This is used only by developer. Not part of release:
\newcommand\markupgrid[1]{}
\gdef\my@developer@grid{}
\InputIfFileExists{Novelette-Developer.sty}{}{}
%%



%%
\endinput
%%
%% End of file Novelette-CalculateLayout.sty.
